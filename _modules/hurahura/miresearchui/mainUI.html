

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>hurahura.miresearchui.mainUI &mdash; hurahura 0.1.8 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=22607128"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            hurahura
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concept.html">Concept</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage_codefree.html">Usage_codefree</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage_subclass.html">Usage_subclass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../watch_dog.html">Watch Dog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web_interface.html">Web Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hurahura.html">hurahura package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">hurahura</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">hurahura</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">hurahura.miresearchui.mainUI</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for hurahura.miresearchui.mainUI</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span>
<span class="kn">from</span> <span class="nn">nicegui</span> <span class="kn">import</span> <span class="n">ui</span><span class="p">,</span> <span class="n">app</span>
<span class="kn">from</span> <span class="nn">ngawari</span> <span class="kn">import</span> <span class="n">fIO</span>
<span class="kn">import</span> <span class="nn">asyncio</span>  

<span class="kn">from</span> <span class="nn">hurahura</span> <span class="kn">import</span> <span class="n">mi_subject</span>
<span class="kn">from</span> <span class="nn">hurahura.miresearchui</span> <span class="kn">import</span> <span class="n">miui_helpers</span>
<span class="kn">from</span> <span class="nn">hurahura.miresearchui.local_directory_picker</span> <span class="kn">import</span> <span class="n">local_file_picker</span>
<span class="kn">from</span> <span class="nn">hurahura.miresearchui.subjectUI</span> <span class="kn">import</span> <span class="n">subject_page</span>
<span class="c1"># from hurahura.miresearchui import miui_settings_page</span>
<span class="kn">from</span> <span class="nn">hurahura.mi_config</span> <span class="kn">import</span> <span class="n">MIResearch_config</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== Starting mainUI.py === DEBUG: </span><span class="si">{</span><span class="n">MIResearch_config</span><span class="o">.</span><span class="n">DEBUG</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  

<span class="c1"># Set up logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="k">if</span> <span class="n">MIResearch_config</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="c1"># Remove all existing handlers first</span>
<span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

<span class="c1"># Create console handler</span>
<span class="n">console_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
<span class="n">console_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="k">if</span> <span class="n">MIResearch_config</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
    <span class="n">console_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="c1"># Create formatter</span>
<span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> | </span><span class="si">%(levelname)-7s</span><span class="s1"> | </span><span class="si">%(name)s</span><span class="s1"> | </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%b-%y %H:%M:%S&#39;</span><span class="p">)</span>
<span class="n">console_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>

<span class="c1"># Add handler to logger</span>
<span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">console_handler</span><span class="p">)</span>


<span class="c1"># ==========================================================================================</span>

<span class="c1"># ==========================================================================================</span>
<span class="c1"># ==========================================================================================</span>
<span class="c1"># MAIN CLASS </span>
<span class="c1"># ==========================================================================================</span>
<div class="viewcode-block" id="MIResearchUI">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI">[docs]</a>
<span class="k">class</span> <span class="nc">MIResearchUI</span><span class="p">():</span>

    <span class="c1"># Constants</span>
    <span class="n">ROWS_PER_PAGE</span> <span class="o">=</span> <span class="mi">20</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataRoot</span> <span class="o">=</span> <span class="n">MIResearch_config</span><span class="o">.</span><span class="n">data_root_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subjectList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubjClass</span> <span class="o">=</span> <span class="n">MIResearch_config</span><span class="o">.</span><span class="n">class_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subject_prefix</span> <span class="o">=</span> <span class="n">MIResearch_config</span><span class="o">.</span><span class="n">subject_prefix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tableRows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="c1"># Add pagination cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pageCache</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Cache for loaded pages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROWS_PER_PAGE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totalSubjects</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="c1"># Store references to UI elements for updates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page_info_label</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page_count_label</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">tableCols</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;subjID&#39;</span><span class="p">,</span> <span class="s1">&#39;sortable&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;checkboxSelection&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;multiSelect&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="s1">&#39;agTextColumnFilter&#39;</span><span class="p">,</span> <span class="s1">&#39;filterParams&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;filterOptions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;contains&#39;</span><span class="p">,</span> <span class="s1">&#39;notContains&#39;</span><span class="p">]}},</span>
            <span class="p">{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="s1">&#39;agTextColumnFilter&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;sortable&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> 
                <span class="s1">&#39;filterParams&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;filterOptions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;contains&#39;</span><span class="p">,</span> <span class="s1">&#39;notContains&#39;</span><span class="p">,</span> <span class="s1">&#39;startsWith&#39;</span><span class="p">]}},</span>
            <span class="p">{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;DOS&#39;</span><span class="p">,</span> <span class="s1">&#39;sortable&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="s1">&#39;agDateColumnFilter&#39;</span><span class="p">,</span> <span class="s1">&#39;filterParams&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;comparator&#39;</span><span class="p">:</span> <span class="s1">&#39;function(filterLocalDateAtMidnight, cellValue) { &#39;</span>
                              <span class="s1">&#39;if (!cellValue) return false; &#39;</span>
                              <span class="s1">&#39;var dateParts = cellValue.split(&quot;&quot;); &#39;</span>
                              <span class="s1">&#39;var cellDate = new Date(dateParts[0] + dateParts[1] + dateParts[2] + dateParts[3], &#39;</span>
                              <span class="s1">&#39;dateParts[4] + dateParts[5] - 1, &#39;</span>
                              <span class="s1">&#39;dateParts[6] + dateParts[7]); &#39;</span>
                              <span class="s1">&#39;return cellDate &lt;= filterLocalDateAtMidnight; &#39;</span>
                              <span class="s1">&#39;}&#39;</span><span class="p">,</span>
                <span class="s1">&#39;browserDatePicker&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">}},</span>
            <span class="p">{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;StudyID&#39;</span><span class="p">,</span> <span class="s1">&#39;sortable&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="s1">&#39;agNumberColumnFilter&#39;</span><span class="p">,</span> <span class="s1">&#39;filterParams&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;filterOptions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;equals&#39;</span><span class="p">,</span> <span class="s1">&#39;notEqual&#39;</span><span class="p">,</span> <span class="s1">&#39;lessThan&#39;</span><span class="p">,</span> <span class="s1">&#39;lessThanOrEqual&#39;</span><span class="p">,</span> <span class="s1">&#39;greaterThan&#39;</span><span class="p">,</span> <span class="s1">&#39;greaterThanOrEqual&#39;</span><span class="p">,</span> <span class="s1">&#39;inRange&#39;</span><span class="p">]}},</span>
            <span class="p">{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;sortable&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="s1">&#39;agNumberColumnFilter&#39;</span><span class="p">,</span> <span class="s1">&#39;filterParams&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;filterOptions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;inRange&#39;</span><span class="p">,</span> <span class="s1">&#39;lessThan&#39;</span><span class="p">,</span> <span class="s1">&#39;greaterThan&#39;</span><span class="p">,]},</span> <span class="s1">&#39;valueFormatter&#39;</span><span class="p">:</span> <span class="s1">&#39;value.toFixed(2)&#39;</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;sortable&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="s1">&#39;agTextColumnFilter&#39;</span><span class="p">,</span> <span class="s1">&#39;filterParams&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;filterOptions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;contains&#39;</span><span class="p">,</span> <span class="s1">&#39;notContains&#39;</span><span class="p">]}},</span>
            
            <span class="p">{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;open&#39;</span><span class="p">}</span> <span class="c1"># </span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aggrid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Add this to store the page reference</span>


    <span class="c1"># ========================================================================================</span>
    <span class="c1"># SETUP AND RUN</span>
    <span class="c1"># ========================================================================================        </span>
<div class="viewcode-block" id="MIResearchUI.setUpAndRun">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI.setUpAndRun">[docs]</a>
    <span class="k">def</span> <span class="nf">setUpAndRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>    
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Starting setUpAndRun&quot;</span><span class="p">)</span>
        
        <span class="c1"># Create a container for all UI elements</span>
        <span class="k">with</span> <span class="n">ui</span><span class="o">.</span><span class="n">column</span><span class="p">()</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;w-full h-full&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">main_container</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">ui</span><span class="o">.</span><span class="n">row</span><span class="p">()</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;w-full border&#39;</span><span class="p">):</span>
                <span class="n">ui</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data Root&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataRoot</span><span class="p">,</span> <span class="n">on_change</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">updateDataRoot</span><span class="p">)</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;min-w-[32rem]&#39;</span><span class="p">)</span>
                <span class="n">ui</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Subject Prefix&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subject_prefix</span><span class="p">,</span> <span class="n">on_change</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">updateSubjectPrefix</span><span class="p">)</span>
                <span class="n">ui</span><span class="o">.</span><span class="n">space</span><span class="p">()</span>
                <span class="n">ui</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">on_click</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;refresh&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;ml-auto&#39;</span><span class="p">)</span>

            <span class="n">myhtml_column</span> <span class="o">=</span> <span class="n">miui_helpers</span><span class="o">.</span><span class="n">get_index_of_field_open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tableCols</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">ui</span><span class="o">.</span><span class="n">row</span><span class="p">()</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;w-full flex-grow border&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">aggrid</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">aggrid</span><span class="p">({</span>
                            <span class="s1">&#39;columnDefs&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tableCols</span><span class="p">,</span>
                            <span class="s1">&#39;rowData&#39;</span><span class="p">:</span> <span class="p">[],</span>  <span class="c1"># Start with empty data</span>
                            <span class="s1">&#39;rowSelection&#39;</span><span class="p">:</span> <span class="s1">&#39;multiple&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;stopEditingWhenCellsLoseFocus&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="s1">&#39;domLayout&#39;</span><span class="p">:</span> <span class="s1">&#39;autoHeight&#39;</span>
                                <span class="p">},</span> 
                                <span class="n">html_columns</span><span class="o">=</span><span class="p">[</span><span class="n">myhtml_column</span><span class="p">])</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;w-full h-full&#39;</span><span class="p">)</span>
                

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Creating button row&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">ui</span><span class="o">.</span><span class="n">row</span><span class="p">():</span>
                <span class="n">ui</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s1">&#39;Load subject&#39;</span><span class="p">,</span> <span class="n">on_click</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">load_subject</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;upload&#39;</span><span class="p">)</span>
                <span class="n">ui</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s1">&#39;Delete selected&#39;</span><span class="p">,</span> <span class="n">on_click</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_selected</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;delete&#39;</span><span class="p">)</span>
                <span class="n">ui</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s1">&#39;Shutdown&#39;</span><span class="p">,</span> <span class="n">on_click</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shutdown</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;power_settings_new&#39;</span><span class="p">)</span>
                
                <span class="c1"># Add page navigation info</span>
                <span class="k">with</span> <span class="n">ui</span><span class="o">.</span><span class="n">row</span><span class="p">()</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;w-full justify-center mt-2&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">page_info_label</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Page </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span><span class="si">}</span><span class="s1"> of </span><span class="si">{</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totalSubjects</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;text-sm text-gray-600&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">page_count_label</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">totalSubjects</span><span class="si">}</span><span class="s1"> total subjects, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span><span class="si">}</span><span class="s1"> per page)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;text-xs text-gray-500 ml-2&#39;</span><span class="p">)</span>
                
                <span class="c1"># Add page navigation controls</span>
                <span class="k">with</span> <span class="n">ui</span><span class="o">.</span><span class="n">row</span><span class="p">()</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;w-full justify-center mt-2&#39;</span><span class="p">):</span>
                    <span class="n">ui</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s1">&#39;First&#39;</span><span class="p">,</span> <span class="n">on_click</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_page</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;first_page&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;mx-1&#39;</span><span class="p">)</span>
                    <span class="n">ui</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s1">&#39;Previous&#39;</span><span class="p">,</span> <span class="n">on_click</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prev_page</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;navigate_before&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;mx-1&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">page_goto_input</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Go to page&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span><span class="p">),</span> <span class="n">on_change</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">go_to_page</span><span class="p">)</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;w-20 mx-2&#39;</span><span class="p">)</span>
                    <span class="n">ui</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s1">&#39;Next&#39;</span><span class="p">,</span> <span class="n">on_click</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">next_page</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;navigate_next&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;mx-1&#39;</span><span class="p">)</span>
                    <span class="n">ui</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s1">&#39;Last&#39;</span><span class="p">,</span> <span class="n">on_click</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">last_page</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;last_page&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;mx-1&#39;</span><span class="p">)</span>
            
            <span class="c1"># Footer</span>
            <span class="k">with</span> <span class="n">ui</span><span class="o">.</span><span class="n">row</span><span class="p">()</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;w-full bg-gray-100 border-t p-4 mt-8&#39;</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">ui</span><span class="o">.</span><span class="n">column</span><span class="p">()</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;w-full text-center&#39;</span><span class="p">):</span>
                    <span class="n">ui</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s1">&#39;hurahura - Medical Imaging Research Platform&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;text-sm text-gray-600&#39;</span><span class="p">)</span>
                    <span class="k">with</span> <span class="n">ui</span><span class="o">.</span><span class="n">row</span><span class="p">()</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;w-full justify-center mt-2&#39;</span><span class="p">):</span>
                        <span class="n">ui</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="s1">&#39;Documentation&#39;</span><span class="p">,</span> <span class="s1">&#39;https://fraser29.github.io/hurahura/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;text-xs text-blue-600 hover:text-blue-800 mx-2&#39;</span><span class="p">)</span>
                        <span class="n">ui</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="s1">&#39;GitHub&#39;</span><span class="p">,</span> <span class="s1">&#39;https://github.com/fraser29/hurahura&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;text-xs text-blue-600 hover:text-blue-800 mx-2&#39;</span><span class="p">)</span>
        
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;setUpAndRun completed, returning main_container&quot;</span><span class="p">)</span>
        
        <span class="c1"># Load initial data immediately</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSubjectList</span><span class="p">()</span>
        
        <span class="c1"># Ensure page display is updated after initial load</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_page_display</span><span class="p">()</span>
        
        <span class="c1"># Return the main container so it&#39;s displayed on the page</span>
        <span class="k">return</span> <span class="n">main_container</span></div>


<div class="viewcode-block" id="MIResearchUI.addPageChangeHandler">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI.addPageChangeHandler">[docs]</a>
    <span class="k">def</span> <span class="nf">addPageChangeHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add JavaScript handler for page changes&quot;&quot;&quot;</span>
        <span class="c1"># No longer needed since we&#39;re not using aggrid pagination</span>
        <span class="k">pass</span></div>


    <span class="c1"># ========================================================================================</span>
<div class="viewcode-block" id="MIResearchUI.updateDataRoot">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI.updateDataRoot">[docs]</a>
    <span class="k">def</span> <span class="nf">updateDataRoot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataRoot</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">value</span></div>

    
<div class="viewcode-block" id="MIResearchUI.updateSubjectPrefix">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI.updateSubjectPrefix">[docs]</a>
    <span class="k">def</span> <span class="nf">updateSubjectPrefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subject_prefix</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">value</span></div>

    
    
<div class="viewcode-block" id="MIResearchUI.refresh">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI.refresh">[docs]</a>
    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Refreshing subject list for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataRoot</span><span class="si">}</span><span class="s2"> with prefix </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subject_prefix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Clear cache and reload</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pageCache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSubjectList</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_page_display</span><span class="p">()</span></div>



<div class="viewcode-block" id="MIResearchUI.shutdown">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI.shutdown">[docs]</a>
    <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Shutting down UI&quot;</span><span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span></div>


    <span class="c1"># ========================================================================================</span>
    <span class="c1"># SUBJECT LEVEL ACTIONS</span>
    <span class="c1"># ========================================================================================      </span>
<div class="viewcode-block" id="MIResearchUI.load_subject">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI.load_subject">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Init loading subject&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Simple directory picker without timeout</span>
            <span class="n">picker</span> <span class="o">=</span> <span class="n">local_file_picker</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="n">upper_limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">DIR_ONLY</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">picker</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Result: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No directory chosen&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            
            <span class="n">choosenDir</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directory chosen: </span><span class="si">{</span><span class="n">choosenDir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="c1"># Create loading notification</span>
            <span class="n">loading_notification</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">notification</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Loading subject...&#39;</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ongoing&#39;</span><span class="p">,</span>
                <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span>  <span class="c1"># Keep showing until we close it</span>
            <span class="p">)</span>
            

            <span class="c1"># Run the long operation in background</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">background_load</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading subject from </span><span class="si">{</span><span class="n">choosenDir</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataRoot</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="n">mi_subject</span><span class="o">.</span><span class="n">createNew_OrAddTo_Subject</span><span class="p">,</span> <span class="n">choosenDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataRoot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubjClass</span><span class="p">)</span>
                    <span class="n">loading_notification</span><span class="o">.</span><span class="n">dismiss</span><span class="p">()</span>
                    <span class="n">ui</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded subject </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">SubjClass</span><span class="o">.</span><span class="n">subjID</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;positive&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
                    
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">loading_notification</span><span class="o">.</span><span class="n">dismiss</span><span class="p">()</span>
                    <span class="n">ui</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading subject: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading subject: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="c1"># Start background task</span>
            <span class="n">ui</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">background_load</span><span class="p">(),</span> <span class="n">once</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in directory picker: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ui</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading subject: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

    

<div class="viewcode-block" id="MIResearchUI.delete_selected">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI.delete_selected">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">delete_selected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking for selected subjects&quot;</span><span class="p">)</span>
        <span class="n">selected_rows</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggrid</span><span class="o">.</span><span class="n">get_selected_rows</span><span class="p">()</span>
        <span class="n">subject_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;subjID&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">selected_rows</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected rows: </span><span class="si">{</span><span class="n">subject_ids</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">selected_rows</span><span class="p">:</span>
            <span class="n">ui</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;No subjects selected for deletion&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)</span>
            <span class="k">return</span>
            
        <span class="c1"># Ask for confirmation</span>
        <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_rows</span><span class="p">)</span>
        <span class="n">subject_list</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subject_ids</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># Show first 3, add &quot;...&quot; if more</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">subject_list</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; and </span><span class="si">{</span><span class="n">count</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="si">}</span><span class="s2"> more&quot;</span>
            
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Are you sure you want to delete </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> selected subject(s)?</span><span class="se">\n\n</span><span class="s2">Subjects: </span><span class="si">{</span><span class="n">subject_list</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Run confirm dialog:&quot;</span><span class="p">)</span>
        
        <span class="c1"># Create and show the confirmation dialog</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">dialog</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">dialog</span><span class="p">,</span> <span class="n">ui</span><span class="o">.</span><span class="n">card</span><span class="p">():</span>
            <span class="n">ui</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;text-lg mb-4&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">ui</span><span class="o">.</span><span class="n">row</span><span class="p">()</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;w-full justify-end&#39;</span><span class="p">):</span>
                <span class="n">ui</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s1">&#39;Cancel&#39;</span><span class="p">,</span> <span class="n">on_click</span><span class="o">=</span><span class="n">dialog</span><span class="o">.</span><span class="n">close</span><span class="p">)</span><span class="o">.</span><span class="n">props</span><span class="p">(</span><span class="s1">&#39;outline&#39;</span><span class="p">)</span>
                <span class="n">ui</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s1">&#39;Delete&#39;</span><span class="p">,</span> <span class="n">on_click</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_confirm_delete</span><span class="p">(</span><span class="n">subject_ids</span><span class="p">,</span> <span class="n">dialog</span><span class="p">))</span><span class="o">.</span><span class="n">classes</span><span class="p">(</span><span class="s1">&#39;bg-red-500 hover:bg-red-600 text-white&#39;</span><span class="p">)</span>
        
        <span class="c1"># Open the dialog</span>
        <span class="n">dialog</span><span class="o">.</span><span class="n">open</span><span class="p">()</span></div>



    <span class="k">def</span> <span class="nf">_confirm_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject_ids</span><span class="p">,</span> <span class="n">dialog</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the actual deletion after user confirmation&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User confirmed deletion of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">subject_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> subjects&quot;</span><span class="p">)</span>
        <span class="n">dialog</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">iSubjectID</span> <span class="ow">in</span> <span class="n">subject_ids</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting subject: </span><span class="si">{</span><span class="n">iSubjectID</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataRoot</span><span class="p">,</span> <span class="n">iSubjectID</span><span class="p">))</span>
            <span class="n">ui</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deletion confirmed for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">subject_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> subject(s)&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;positive&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Run confirm dialog: done&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during deletion: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ui</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during deletion: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
    
    
    <span class="c1"># ========================================================================================</span>
    <span class="c1"># SET SUBJECT LIST</span>
    <span class="c1"># ========================================================================================    </span>
<div class="viewcode-block" id="MIResearchUI.setSubjectList">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI.setSubjectList">[docs]</a>
    <span class="k">def</span> <span class="nf">setSubjectList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting subject list for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataRoot</span><span class="si">}</span><span class="s2"> with prefix </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subject_prefix</span><span class="si">}</span><span class="s2">. Class: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">SubjClass</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Only get the directory listing, don&#39;t load all subjects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subjectList</span> <span class="o">=</span> <span class="n">mi_subject</span><span class="o">.</span><span class="n">SubjectList</span><span class="o">.</span><span class="n">setByDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataRoot</span><span class="p">,</span> 
                                                                    <span class="n">subjectPrefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subject_prefix</span><span class="p">,</span>
                                                                    <span class="n">SubjClass</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SubjClass</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totalSubjects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subjectList</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">totalSubjects</span><span class="si">}</span><span class="s2"> subjects (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataRoot</span><span class="p">))</span><span class="si">}</span><span class="s2"> possible sub-directories)&quot;</span><span class="p">)</span>
        
        <span class="c1"># Debug: show what we found</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalSubjects</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No subjects found!&quot;</span><span class="p">)</span>
        
        <span class="c1"># Load first page</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadPage</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateTable</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_page_display</span><span class="p">()</span></div>



<div class="viewcode-block" id="MIResearchUI.loadPage">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI.loadPage">[docs]</a>
    <span class="k">def</span> <span class="nf">loadPage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page_num</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load a specific page of data, with caching&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">page_num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageCache</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Page </span><span class="si">{</span><span class="n">page_num</span><span class="si">}</span><span class="s2"> found in cache&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageCache</span><span class="p">[</span><span class="n">page_num</span><span class="p">]</span>
        
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading page </span><span class="si">{</span><span class="n">page_num</span><span class="si">}</span><span class="s2"> from disk (subjects </span><span class="si">{</span><span class="p">((</span><span class="n">page_num</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">page_num</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">totalSubjects</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        
        <span class="c1"># Check if we have any subjects</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">subjectList</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No subjects available to load&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pageCache</span><span class="p">[</span><span class="n">page_num</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">return</span> <span class="p">[]</span>
        
        <span class="n">start_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">page_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="n">start_idx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span>
        
        <span class="c1"># Get subjects for this page</span>
        <span class="n">page_subjects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subjectList</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span>
        <span class="n">page_data</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">isubj</span> <span class="ow">in</span> <span class="n">page_subjects</span><span class="p">:</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="n">isubj</span><span class="o">.</span><span class="n">getMetaDict</span><span class="p">()</span>
            <span class="n">classPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubjClass</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">SubjClass</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="n">addr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;subject_page/</span><span class="si">{</span><span class="n">isubj</span><span class="o">.</span><span class="n">subjID</span><span class="si">}</span><span class="s2">?dataRoot=</span><span class="si">{</span><span class="n">quote</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataRoot</span><span class="p">)</span><span class="si">}</span><span class="s2">&amp;classPath=</span><span class="si">{</span><span class="n">quote</span><span class="p">(</span><span class="n">classPath</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">page_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;subjID&#39;</span><span class="p">:</span> <span class="n">isubj</span><span class="o">.</span><span class="n">subjID</span><span class="p">,</span> 
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">),</span>
                <span class="s1">&#39;DOS&#39;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StudyDate&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">),</span>
                <span class="s1">&#39;StudyID&#39;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StudyID&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">),</span>
                <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">),</span>
                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">isubj</span><span class="o">.</span><span class="n">getStatus</span><span class="p">(),</span>
                <span class="s1">&#39;open&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&lt;a href=</span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2">&gt;View </span><span class="si">{</span><span class="n">isubj</span><span class="o">.</span><span class="n">subjID</span><span class="si">}</span><span class="s2">&lt;/a&gt;&quot;</span>
            <span class="p">})</span>
        
        <span class="c1"># Cache this page</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pageCache</span><span class="p">[</span><span class="n">page_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_data</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cached page </span><span class="si">{</span><span class="n">page_num</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">page_data</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows&quot;</span><span class="p">)</span>
        <span class="c1"># Keep cache size manageable (keep current page + adjacent pages)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cleanupCache</span><span class="p">(</span><span class="n">page_num</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">page_data</span></div>


<div class="viewcode-block" id="MIResearchUI.getPaginationStats">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI.getPaginationStats">[docs]</a>
    <span class="k">def</span> <span class="nf">getPaginationStats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get current pagination statistics for debugging&quot;&quot;&quot;</span>
        <span class="n">total_pages</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totalSubjects</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span>
        <span class="n">cached_pages</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pageCache</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;total_subjects&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalSubjects</span><span class="p">,</span>
            <span class="s1">&#39;total_pages&#39;</span><span class="p">:</span> <span class="n">total_pages</span><span class="p">,</span>
            <span class="s1">&#39;current_page&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span><span class="p">,</span>
            <span class="s1">&#39;page_size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span><span class="p">,</span>
            <span class="s1">&#39;cached_pages&#39;</span><span class="p">:</span> <span class="n">cached_pages</span><span class="p">,</span>
            <span class="s1">&#39;cache_size&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pageCache</span><span class="p">)</span>
        <span class="p">}</span></div>


    <span class="k">def</span> <span class="nf">_cleanupCache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_page</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Keep only current page and adjacent pages in cache&quot;&quot;&quot;</span>
        <span class="n">pages_to_keep</span> <span class="o">=</span> <span class="p">{</span><span class="n">current_page</span><span class="p">,</span> <span class="n">current_page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">current_page</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span>
        <span class="n">pages_to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageCache</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pages_to_keep</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">pages_to_remove</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">page</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Don&#39;t remove page 0</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageCache</span><span class="p">[</span><span class="n">page</span><span class="p">]</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed page </span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2"> from cache&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="MIResearchUI.onPageChanged">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI.onPageChanged">[docs]</a>
    <span class="k">def</span> <span class="nf">onPageChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_page</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle page changes from the grid&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Page changed to </span><span class="si">{</span><span class="n">new_page</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span> <span class="o">=</span> <span class="n">new_page</span>
        
        <span class="c1"># Load the new page if not in cache</span>
        <span class="k">if</span> <span class="n">new_page</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageCache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadPage</span><span class="p">(</span><span class="n">new_page</span><span class="p">)</span>
        
        <span class="c1"># Update the table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateTable</span><span class="p">()</span></div>


    <span class="c1"># ========================================================================================</span>
    <span class="c1"># UPDATE TABLE</span>
    <span class="c1"># ======================================================================================== </span>
<div class="viewcode-block" id="MIResearchUI.updateTable">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI.updateTable">[docs]</a>
    <span class="k">def</span> <span class="nf">updateTable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update table with current page data&quot;&quot;&quot;</span>
        <span class="c1"># If no page cache exists yet, load the first page</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageCache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadPage</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="n">current_page_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageCache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">current_page_data</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No data found for page </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>
            
        <span class="c1"># Update the grid with the current page data</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating table with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">current_page_data</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows for page </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Use the proper aggrid update method - modify options and call update()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aggrid</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;rowData&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_page_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aggrid</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Updated table with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">current_page_data</span><span class="p">)</span><span class="si">}</span><span class="s1"> rows from page </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="c1"># If still no data, show a fallback message</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">current_page_data</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalSubjects</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No data displayed despite having subjects. Adding fallback data.&quot;</span><span class="p">)</span>
            <span class="c1"># Add some fallback data to see if the grid is working</span>
            <span class="n">fallback_data</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;subjID&#39;</span><span class="p">:</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Debug Mode&#39;</span><span class="p">,</span> <span class="s1">&#39;DOS&#39;</span><span class="p">:</span> <span class="s1">&#39;N/A&#39;</span><span class="p">,</span> <span class="s1">&#39;StudyID&#39;</span><span class="p">:</span> <span class="s1">&#39;N/A&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="s1">&#39;N/A&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;Debug&#39;</span><span class="p">,</span> <span class="s1">&#39;open&#39;</span><span class="p">:</span> <span class="s1">&#39;Debug Link&#39;</span><span class="p">}]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aggrid</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;rowData&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fallback_data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aggrid</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Added fallback debug data to verify grid functionality&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="MIResearchUI.clearTable">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI.clearTable">[docs]</a>
    <span class="k">def</span> <span class="nf">clearTable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tableRows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pageCache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aggrid</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;rowData&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aggrid</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>



<div class="viewcode-block" id="MIResearchUI.next_page">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI.next_page">[docs]</a>
    <span class="k">def</span> <span class="nf">next_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Navigate to the next page&quot;&quot;&quot;</span>
        <span class="n">total_pages</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totalSubjects</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span> <span class="o">&lt;</span> <span class="n">total_pages</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateTable</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_page_display</span><span class="p">()</span></div>


<div class="viewcode-block" id="MIResearchUI.prev_page">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI.prev_page">[docs]</a>
    <span class="k">def</span> <span class="nf">prev_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Navigate to the previous page&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateTable</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_page_display</span><span class="p">()</span></div>


<div class="viewcode-block" id="MIResearchUI.first_page">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI.first_page">[docs]</a>
    <span class="k">def</span> <span class="nf">first_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Navigate to the first page&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadPage</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateTable</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_page_display</span><span class="p">()</span></div>


<div class="viewcode-block" id="MIResearchUI.last_page">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI.last_page">[docs]</a>
    <span class="k">def</span> <span class="nf">last_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Navigate to the last page&quot;&quot;&quot;</span>
        <span class="n">total_pages</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totalSubjects</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span> <span class="o">&lt;</span> <span class="n">total_pages</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span> <span class="o">=</span> <span class="n">total_pages</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadPage</span><span class="p">(</span><span class="n">total_pages</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateTable</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_page_display</span><span class="p">()</span></div>


<div class="viewcode-block" id="MIResearchUI.go_to_page">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI.go_to_page">[docs]</a>
    <span class="k">def</span> <span class="nf">go_to_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Navigate to the page number entered in the input field&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">page_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">page_num</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">page_num</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">page_num</span> <span class="o">&gt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totalSubjects</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span><span class="p">:</span>
                <span class="n">page_num</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totalSubjects</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span>
            
            <span class="k">if</span> <span class="n">page_num</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span> <span class="o">=</span> <span class="n">page_num</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loadPage</span><span class="p">(</span><span class="n">page_num</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateTable</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_page_display</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="MIResearchUI.update_page_display">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.MIResearchUI.update_page_display">[docs]</a>
    <span class="k">def</span> <span class="nf">update_page_display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the page info display labels&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_info_label</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_count_label</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_goto_input</span><span class="p">:</span>
            <span class="n">total_pages</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totalSubjects</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">page_info_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Page </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span><span class="si">}</span><span class="s1"> of </span><span class="si">{</span><span class="n">total_pages</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">page_goto_input</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">page_count_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">totalSubjects</span><span class="si">}</span><span class="s1"> total subjects, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pageSize</span><span class="si">}</span><span class="s1"> per page)&#39;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated page display: Page </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPage</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">total_pages</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>
</div>


    <span class="c1"># ========================================================================================</span>
<span class="c1"># ==========================================================================================</span>
<span class="c1"># ==========================================================================================</span>
<span class="c1"># Global instance to hold the UI configuration</span>
<span class="n">_global_ui_runner</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="UIRunner">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.UIRunner">[docs]</a>
<span class="k">class</span> <span class="nc">UIRunner</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8081</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">miui</span> <span class="o">=</span> <span class="n">MIResearchUI</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="c1"># Store this instance globally so the page methods can access it</span>
        <span class="k">global</span> <span class="n">_global_ui_runner</span>
        <span class="n">_global_ui_runner</span> <span class="o">=</span> <span class="bp">self</span>

<div class="viewcode-block" id="UIRunner.run">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.UIRunner.run">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@ui</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="s1">&#39;/miresearch&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;hurahura - Medical Imaging Research&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Page /miresearch accessed&quot;</span><span class="p">)</span>
        <span class="k">global</span> <span class="n">_global_ui_runner</span>
        <span class="k">if</span> <span class="n">_global_ui_runner</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;UI not initialized&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ui</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s2">&quot;Error: UI not initialized&quot;</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Set up the UI when this page is accessed and return the UI elements</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">_global_ui_runner</span><span class="o">.</span><span class="n">miui</span><span class="o">.</span><span class="n">setUpAndRun</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UI setup completed&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in UI setup: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="kn">import</span> <span class="nn">traceback</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="c1"># Return a simple error message if setup fails</span>
            <span class="k">return</span> <span class="n">ui</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error setting up UI: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="UIRunner.home">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.UIRunner.home">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@ui</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">home</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Home page accessed, redirecting to miresearch&quot;</span><span class="p">)</span>
        <span class="c1"># Redirect to the miresearch page</span>
        <span class="n">ui</span><span class="o">.</span><span class="n">navigate</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;/miresearch&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ui</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s2">&quot;Redirecting to MIRESEARCH...&quot;</span><span class="p">)</span></div>
</div>



<span class="c1"># ==========================================================================================</span>
<span class="c1"># RUN THE UI</span>
<span class="c1"># ==========================================================================================    </span>
<div class="viewcode-block" id="runMIUI">
<a class="viewcode-back" href="../../../hurahura.miresearchui.html#hurahura.miresearchui.mainUI.runMIUI">[docs]</a>
<span class="k">def</span> <span class="nf">runMIUI</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">8081</span><span class="p">):</span>
    <span class="c1"># Create the UI instance</span>
    <span class="n">miui</span> <span class="o">=</span> <span class="n">UIRunner</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
    <span class="c1"># Start the NiceGUI server</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ui</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">miui</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">favicon</span><span class="o">=</span><span class="s1">&#39;🩻&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;hurahura&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MIUI shutdown requested by user&quot;</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;__main__&quot;</span><span class="p">,</span> <span class="s2">&quot;__mp_main__&quot;</span><span class="p">}:</span>
    <span class="c1"># app.on_shutdown(miui_helpers.cleanup)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="n">port</span> <span class="o">=</span> <span class="mi">8081</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting MIRESEARCH UI on port </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">runMIUI</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Fraser M. Callaghan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>